---
import IconBadge from "./IconBadge.astro";
const { site } = Astro.props;
const p = site.pricing ?? {};
const plans = p.plans ?? [];
const tableRows = (p.features ?? []).length
  ? p.features.map((r) => ({ label: r.label, values: r.values }))
  : (p.rows ?? []).map((r) => ({ label: r.feature, values: [r.basic, r.premium] }));
---
<section id="pricing" class="nb-section">
  <div class="nb-shell">
    <div class="nb-section-head center">
      <h2>{p.title ?? 'Service Plan Comparison'}</h2>
      {p.subtitle && <p>{p.subtitle}</p>}
    </div>
    <div class="nb-pricing-summary">
      {plans.map((plan) => (
        <article class="nb-plan-card nb-pop">
          <h3>{plan.name}</h3>
          <p>{plan.monthly}</p>
          <a href="#contact" class="nb-btn nb-btn-primary nb-btn-small nb-pop" data-target="contact">
            <IconBadge name="calendar" class="inline" />
            <span>{plan.cta ?? 'Request more information'}</span>
          </a>
        </article>
      ))}
    </div>
    <div class="nb-pricing-table-wrap nb-pop">
      <table class="nb-pricing-table">
        <thead>
          <tr>
            <th>Feature</th>
            {plans.map((plan) => <th>{plan.name}</th>)}
          </tr>
        </thead>
        <tbody>
          {tableRows.map((row) => (
            <tr>
              <td>{row.label}</td>
              {(row.values ?? []).map((v) => (
                <td set:html={String(v ?? '').replaceAll('✔', '<span class="nb-check">✔</span>').replaceAll('✓', '<span class="nb-check">✓</span>')} />
              ))}
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  </div>
</section>
