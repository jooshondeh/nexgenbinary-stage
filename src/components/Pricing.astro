---
const { site } = Astro.props;
const pricing = site?.pricing || {};
const plans = pricing.plans || [];
const rows = pricing.rows || [];
const fmt = (v) => String(v || '—');
const parsePlanValue = (raw) => {
  const v = String(raw || '').trim();
  const checked = v.includes('✔');
  const noCheck = v.replaceAll('✔', '').trim();
  const match = noCheck.match(/^(.*?)(\s*\([^)]*\))$/);
  if (match) {
    return { checked, main: match[1].trim(), note: match[2].trim() };
  }
  return { checked, main: noCheck, note: '' };
};
---
<section id="pricing" class="nb-section nb-anchor-offset nb-pricing-wrap">
  <div class="nb-shell">
    <h2 class="nb-section-title nb-center">{pricing.title || 'Service Plan Comparison'}</h2>
    {pricing.subtitle && <p class="nb-section-subtitle nb-center">{pricing.subtitle}</p>}

    <div class="nb-plan-columns">
      {[0,1].map((idx) => {
        const plan = plans[idx] || {};
        const key = idx === 0 ? 'basic' : 'premium';
        return (
          <article class={`nb-plan-card nb-hover-pop ${idx === 1 ? 'is-featured' : ''}`}>
            <div class="nb-plan-intro-block">
              {plan.badge && <span class="nb-plan-badge">{plan.badge}</span>}
              <h3>{plan.name}</h3>
              <p>{plan.monthly}</p>
              {plan.note && <p class="nb-plan-note">{plan.note}</p>}
              <a class="nb-btn-primary nb-btn-small" href="#contact">
                <span class="nb-btn-inlineicon"><span class="nb-inline-icon-wrap"><svg viewBox="0 0 24 24" aria-hidden="true"><rect x="3" y="5" width="18" height="16" rx="2" ry="2" fill="none" stroke="currentColor" stroke-width="2"/><path d="M16 3v4M8 3v4M3 10h18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg></span>Request more information</span>
              </a>
            </div>
            <div class="nb-plan-rows">
              {rows.map((row, rowIndex) => {
                const parsed = parsePlanValue(fmt(row[key]));
                return (
                  <div class={`nb-plan-row ${rowIndex % 2 ? 'is-alt' : ''}`}>
                    <div class="nb-plan-feature">{row.feature}</div>
                    <div class="nb-plan-value">
                      {parsed.checked && <span class="nb-check">✔</span>}
                      <span class="nb-plan-value-main">{parsed.main || '—'}</span>
                      {parsed.note && <span class="nb-plan-value-note">{parsed.note}</span>}
                    </div>
                  </div>
                );
              })}
            </div>
          </article>
        );
      })}
    </div>
  </div>
</section>
