---
import IconBadge from './IconBadge.astro';
const { site } = Astro.props;
const navItems = [
  { href: '#home', label: 'Home' },
  { href: '#services', label: 'Services' },
  { href: '#pricing', label: 'Pricing' },
  { href: '#who-we-serve', label: 'Who We Serve' },
  { href: '#about', label: 'About' },
  { href: '#contact', label: 'Contact' },
];
---
<header class="sticky-top">
  <nav class="navbar navbar-expand-lg nb-navbar py-2">
    <div class="container-fluid px-3 px-lg-4 align-items-center">
      <a class="navbar-brand d-flex align-items-center gap-2 me-3" href="#home" aria-label="NexGen Binary home">
        <img src="/Company_logo.png?v=nb34" alt="NexGen Binary logo" class="nb-logo" width="44" height="44" />
        <span class="d-flex flex-column lh-sm">
          <span class="nb-brand-text fw-bold fs-4">NexGen Binary</span>
          <small class="nb-slogan fw-semibold">Precision Built. People First. Always.</small>
        </span>
      </a>

      <button class="navbar-toggler border-0 shadow-none ms-auto" type="button" data-bs-toggle="collapse" data-bs-target="#nbNav" aria-controls="nbNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="nbNav">
        <ul class="navbar-nav ms-auto align-items-lg-center gap-lg-1">
          {navItems.map((item) => (
            <li class="nav-item"><a class="nav-link" href={item.href}>{item.label}</a></li>
          ))}
          <li class="nav-item ms-lg-2 mt-2 mt-lg-0">
            <a class="btn nb-btn-primary nb-btn-inlineicon px-3 py-2" href="#contact" aria-label={`Call ${site.contact?.phoneText ?? '804-000-0000'}`}>
              <span class="nb-icon"><IconBadge name="phonecall" /></span>
              <span>{site.contact?.phoneText ?? '804-000-0000'}</span>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
</header>

<script>
  const sections = ['home','services','pricing','who-we-serve','about','contact'];
  const links = Array.from(document.querySelectorAll('.navbar .nav-link'));
  const byId = new Map(links.map(l => [l.getAttribute('href')?.replace('#',''), l]));
  const setActive = (id) => {
    links.forEach(l => l.classList.remove('active'));
    byId.get(id)?.classList.add('active');
  };
  setActive('home');

  const obs = new IntersectionObserver((entries) => {
    const visible = entries
      .filter(e => e.isIntersecting)
      .sort((a,b) => b.intersectionRatio - a.intersectionRatio)[0];
    if (visible?.target?.id) setActive(visible.target.id);
  }, { rootMargin: '-30% 0px -55% 0px', threshold: [0.1,0.2,0.35] });

  sections.forEach(id => {
    const el = document.getElementById(id);
    if (el) obs.observe(el);
  });

  links.forEach((link) => {
    link.addEventListener('click', () => {
      const collapse = document.getElementById('nbNav');
      if (collapse?.classList.contains('show') && window.bootstrap) {
        window.bootstrap.Collapse.getOrCreateInstance(collapse).hide();
      }
    });
  });
</script>
