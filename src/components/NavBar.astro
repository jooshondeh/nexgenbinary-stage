---
import brandLogo from '../assets/company-logo-navbar.png';
const { site } = Astro.props;
const navItems = site?.nav ?? [
  { label: 'Home', href: '#home' },
  { label: 'Services', href: '#services' },
  { label: 'Pricing', href: '#pricing' },
  { label: 'Who We Serve', href: '#who-we-serve' },
  { label: 'About', href: '#about' },
  { label: 'Contact', href: '#contact' },
];
const phoneHref = '#contact';
const phoneText = site?.contact?.phoneText ?? '804-000-0000';
const brandName = site?.brand?.name ?? 'NexGen Binary';
const slogan = site?.brand?.slogan ?? 'Precision Built. People First. Always.';
const logoSrc = (brandLogo && brandLogo.src) ? brandLogo.src : brandLogo;
---
<header class="nb-nav-wrap">
  <div class="nb-shell nb-nav-shell">
    <a class="nb-brand" href="#home" aria-label="NexGen Binary home">
      <img class="nb-brand-logo" src={logoSrc} alt="NexGen Binary logo" width="52" height="52" />
      <span class="nb-brand-text">
        <span class="nb-brand-name">{brandName}</span>
        <span class="nb-brand-slogan">{slogan}</span>
      </span>
    </a>

    <button class="nb-nav-toggle" type="button" aria-label="Toggle navigation" aria-expanded="false" aria-controls="nb-nav-menu">
      <span></span><span></span><span></span>
    </button>

    <nav id="nb-nav-menu" class="nb-nav-menu" aria-label="Primary">
      <ul class="nb-nav-links">
        {navItems.map((item) => (
          <li><a class="nb-nav-link" href={item.href}>{item.label}</a></li>
        ))}
      </ul>
      <a class="nb-phone-cta" href={phoneHref}>
        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M6.6 10.8a15.4 15.4 0 0 0 6.6 6.6l2.2-2.2a1 1 0 0 1 1-.24 11 11 0 0 0 3.44.55 1 1 0 0 1 1 1V20a1 1 0 0 1-1 1C10.85 21 3 13.15 3 3.5a1 1 0 0 1 1-1H7.5a1 1 0 0 1 1 1c0 1.19.19 2.34.55 3.44a1 1 0 0 1-.24 1l-2.2 2.86Z" fill="none" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round"/></svg>
        <span>{phoneText}</span>
      </a>
    </nav>
  </div>
</header>

<script is:inline>
  (() => {
    const header = document.querySelector('.nb-nav-wrap');
    const toggle = document.querySelector('.nb-nav-toggle');
    const menu = document.querySelector('.nb-nav-menu');
    const links = Array.from(document.querySelectorAll('.nb-nav-link'));
    if (!header || !toggle || !menu || !links.length) return;

    const ids = links
      .map((l) => (l.getAttribute('href') || '').replace('#', '').trim())
      .filter(Boolean);

    const closeMenu = () => {
      menu.classList.remove('is-open');
      toggle.setAttribute('aria-expanded', 'false');
    };

    const applyActive = (activeId) => {
      links.forEach((link) => {
        const id = (link.getAttribute('href') || '').replace('#', '').trim();
        link.classList.toggle('active', id === activeId);
      });
    };

    const setActive = () => {
      const offset = (header.offsetHeight || 80) + 18;
      let activeId = ids[0] || 'home';

      if (window.scrollY <= 8) {
        applyActive(activeId);
        return;
      }

      for (const id of ids) {
        const section = document.getElementById(id);
        if (!section) continue;
        const top = section.getBoundingClientRect().top + window.scrollY;
        if (window.scrollY + offset >= top) activeId = id;
      }

      const nearBottom = (window.innerHeight + window.scrollY) >= (document.documentElement.scrollHeight - 4);
      if (nearBottom && ids.length) activeId = ids[ids.length - 1];

      applyActive(activeId);
    };

    toggle.addEventListener('click', () => {
      const open = menu.classList.toggle('is-open');
      toggle.setAttribute('aria-expanded', open ? 'true' : 'false');
    });

    links.forEach((link) => link.addEventListener('click', () => {
      const id = (link.getAttribute('href') || '').replace('#', '').trim();
      if (id) applyActive(id);
      if (window.innerWidth < 1081) closeMenu();
      requestAnimationFrame(() => setTimeout(setActive, 60));
    }));

    window.addEventListener('scroll', setActive, { passive: true });
    window.addEventListener('resize', () => {
      if (window.innerWidth >= 1081) menu.classList.remove('is-open');
      setActive();
    });
    window.addEventListener('load', () => {
      if (window.scrollY <= 8) applyActive(ids[0] || 'home');
      setTimeout(setActive, 0);
      setTimeout(setActive, 120);
    });
    window.addEventListener('pageshow', () => {
      if (window.scrollY <= 8) applyActive(ids[0] || 'home');
      setTimeout(setActive, 0);
    });
    window.addEventListener('hashchange', () => setTimeout(setActive, 10));

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        if (window.scrollY <= 8) applyActive(ids[0] || 'home');
        setActive();
      }, { once: true });
    } else {
      if (window.scrollY <= 8) applyActive(ids[0] || 'home');
      setActive();
    }
  })();
</script>
