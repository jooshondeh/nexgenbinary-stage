---
const { site } = Astro.props;

/*
  Nav order aligned to page section order:
  Home -> Services -> Who We Serve -> About -> Pricing -> Contact
*/
const navItems = [
  { label: "Home", href: "#home" },
  { label: "Services", href: "#services" },
  { label: "Who We Serve", href: "#who-we-serve" },
  { label: "About", href: "#about" },
  { label: "Pricing", href: "#pricing" },
  { label: "Contact", href: "#contact" },
];
---
<nav class="navbar navbar-expand-lg fixed-top nb-navbar" aria-label="Main navigation">
  <div class="container">
    <a class="navbar-brand d-flex align-items-center gap-2" href="#home">
      <img
        id="nbLogoImg"
        src="/Company_logo.svg?v=19"
        alt="NexGen Binary logo"
        class="nb-logo"
        width="44"
        height="44"
        onerror="if(!this.dataset.triedPng){this.dataset.triedPng='1';this.src='/Company_logo.png?v=19';}else{this.style.visibility='hidden';}"
      />
      <span class="fw-bold fs-3 nb-brand-text">{site?.brand?.logoText ?? "NexGen Binary"}</span>
    </a>

    <button
      class="navbar-toggler border-0 shadow-none"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#nbNav"
      aria-controls="nbNav"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="nbNav">
      <ul class="navbar-nav ms-auto align-items-lg-center gap-lg-1">
        {navItems.map((item) => (
          <li class="nav-item">
            <a class="nav-link" href={item.href} data-nav-link>{item.label}</a>
          </li>
        ))}
        <li class="nav-item ms-lg-2 mt-2 mt-lg-0">
          <a class="btn nb-btn-primary nb-btn-inlineicon" href="#contact" data-nav-link aria-label="Call NexGen Binary 804-000-0000">
            <span class="nb-phone-dot" aria-hidden="true">â˜Ž</span>
            <span>804-000-0000</span>
          </a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<script is:inline>
  document.addEventListener("DOMContentLoaded", () => {
    const nav = document.getElementById("nbNav");
    const toggler = document.querySelector(".navbar-toggler");
    const links = document.querySelectorAll("[data-nav-link]");
    const sectionLinks = Array.from(document.querySelectorAll('.nav-link[href^="#"]'));

    // close mobile menu after selecting an item
    links.forEach((link) => {
      link.addEventListener("click", () => {
        if (!nav || window.innerWidth >= 992 || !nav.classList.contains("show")) return;
        if (window.bootstrap?.Collapse) {
          window.bootstrap.Collapse.getOrCreateInstance(nav).hide();
        } else {
          nav.classList.remove("show");
          toggler?.setAttribute("aria-expanded", "false");
        }
      });
    });

    // active highlight follows page scroll
    const sections = sectionLinks
      .map((a) => {
        const href = a.getAttribute("href");
        return href ? document.querySelector(href) : null;
      })
      .filter(Boolean);

    const setActive = () => {
      const y = window.scrollY + 120;
      let currentId = "#home";
      sections.forEach((sec) => {
        if (sec && sec.offsetTop <= y) currentId = "#" + sec.id;
      });
      sectionLinks.forEach((a) => a.classList.toggle("active", a.getAttribute("href") === currentId));
    };

    setActive();
    window.addEventListener("scroll", setActive, { passive: true });

    // fallback manual toggle if bootstrap JS is unavailable
    if (toggler && nav && !window.bootstrap?.Collapse) {
      toggler.addEventListener("click", () => {
        const isOpen = nav.classList.contains("show");
        nav.classList.toggle("show", !isOpen);
        toggler.setAttribute("aria-expanded", String(!isOpen));
      });
    }
  });
</script>
