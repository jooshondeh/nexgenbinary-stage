---
import IconBadge from "./IconBadge.astro";
const { site } = Astro.props;
const c = site.contact ?? {};
const formEndpoint = c.formEndpoint || "";
const phoneDisplay = c.phoneDisplay ?? c.phoneText ?? "804-000-0000";
const email = c.email ?? c.emailText ?? "info@nexgenbinary.com";
const coverage = c.coverage ?? site?.whoWeServe?.serviceArea ?? "Richmond, NOVA, and statewide Virginia";
const subtitle = c.subtitle ?? c.lead ?? "If you're looking for reliable IT support that understands dental practices, we'd be happy to connect.";
---
<section id="contact" class="nb-section nb-soft-bg">
  <div class="nb-shell">
    <div class="nb-section-head">
      <h2>{c.title ?? 'Contact'}</h2>
      <p>{subtitle}</p>
    </div>
    <div class="nb-grid-2">
      <div class="nb-card nb-pop">
        <div class="nb-stack">
          <div class="nb-contact-row nb-pop"><IconBadge name="phone" /><div><h3>Phone</h3><p>{phoneDisplay}</p></div></div>
          <div class="nb-contact-row nb-pop"><IconBadge name="mail" /><div><h3>Email</h3><p>{email}</p></div></div>
          <div class="nb-contact-row nb-pop"><IconBadge name="pin" /><div><h3>Coverage</h3><p>{coverage}</p></div></div>
          <div class="nb-contact-row nb-pop"><IconBadge name="calendar" /><div><h3>Hours</h3><p>Monday–Friday · 9:00 AM–5:00 PM</p></div></div>
        </div>
      </div>
      <form class="nb-card nb-form nb-pop" id="contact-form" action={formEndpoint} method="POST">
        <input type="hidden" name="_subject" value="New NexGen Binary Website Inquiry" />
        <label><span>Name</span><input name="name" type="text" required /></label>
        <label><span>Office / Company</span><input name="company" type="text" /></label>
        <label><span>Email</span><input name="email" type="email" required /></label>
        <label><span>Phone</span><input name="phone" type="tel" /></label>
        <label><span>Message</span><textarea name="message" rows="5" required></textarea></label>
        <div class="nb-form-actions">
          <button class="nb-btn nb-btn-primary nb-pop" type="submit"><IconBadge name="mail" class="inline" /><span>Send message</span></button>
          <a class="nb-btn nb-btn-ghost nb-pop" href={`mailto:${email}`}><IconBadge name="mail" class="inline" /><span>Open in email app</span></a>
        </div>
        <p class="nb-form-note" id="contact-form-status" aria-live="polite"></p>
      </form>
    </div>
  </div>
  <script is:inline>
    (() => {
      const form = document.getElementById('contact-form');
      const statusEl = document.getElementById('contact-form-status');
      if (!(form instanceof HTMLFormElement) || !statusEl) return;
      form.addEventListener('submit', async (e) => {
        const action = form.getAttribute('action') || '';
        if (!action) return;
        e.preventDefault();
        statusEl.textContent = 'Sending...';
        try {
          const res = await fetch(action, { method: 'POST', body: new FormData(form) });
          if (!res.ok) throw new Error('Send failed');
          form.reset();
          statusEl.textContent = 'Message sent. Someone will reach out soon.';
          alert('Message sent. Someone will reach out soon.');
        } catch {
          statusEl.textContent = 'Could not send from the website. Please use the email app button.';
        }
      });
    })();
  </script>
</section>
