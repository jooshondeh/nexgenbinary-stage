---
const { site } = Astro.props;
import IconBadge from "./IconBadge.astro";
const s = site.services ?? {};
const groups = s.groups ?? s.items ?? [];

const iconByTitle = (title = "") => {
  const t = title.toLowerCase();
  if (t.includes("fully managed")) return "server";
  if (t.includes("emr") || t.includes("clinical")) return "monitor";
  if (t.includes("microsoft") || t.includes("cloud")) return "cloud";
  if (t.includes("security")) return "shield";
  if (t.includes("network") || t.includes("wifi") || t.includes("camera") || t.includes("voip")) return "network";
  return "tools";
};

const normalize = (g) => ({
  title: g.title ?? g.name ?? "Service",
  items: Array.isArray(g.items) ? g.items : [g.text ?? g.description ?? ""].filter(Boolean),
});
---
<section id="services" class="nb-anchor-offset nb-section">
  <div class="container">
    <h2 class="nb-section-title">{s.title ?? "Services"}</h2>
    <p class="nb-section-subtitle">{s.subtitle ?? ""}</p>

    <div class="row g-3 mt-1">
      {groups.map((raw) => {
        const item = normalize(raw);
        const isWide = /network|wifi|voip|camera/i.test(item.title);
        const left = isWide ? item.items.filter((_, i) => i % 2 === 0) : item.items;
        const right = isWide ? item.items.filter((_, i) => i % 2 === 1) : [];
        return (
          <div class={isWide ? "col-12" : "col-lg-6"}>
            <div class={`nb-card nb-pop h-100 nb-service-card ${isWide ? "nb-service-wide" : ""}`}>
              <div class="nb-service-head">
                <div class="nb-icon-wrap"><IconBadge name={iconByTitle(item.title)} /></div>
                <div class="flex-grow-1">
                  <div class="fw-semibold nb-service-title">{item.title}</div>
                </div>
                <a class="btn nb-btn-primary btn-sm nb-btn-inlineicon nb-service-cta" href="#contact">
                  <span class="nb-btn-icon"><IconBadge name="mail" className="nb-icon-sm" /></span>
                  <span>More info</span>
                </a>
              </div>

              {!isWide && (
                <ul class="nb-bullets mt-3 mb-0">
                  {left.map((feature) => <li>{feature}</li>)}
                </ul>
              )}

              {isWide && (
                <div class="row g-3 mt-1">
                  <div class="col-md-6">
                    <ul class="nb-bullets mb-0">
                      {left.map((feature) => <li>{feature}</li>)}
                    </ul>
                  </div>
                  <div class="col-md-6">
                    <ul class="nb-bullets mb-0">
                      {right.map((feature) => <li>{feature}</li>)}
                    </ul>
                  </div>
                </div>
              )}
            </div>
          </div>
        );
      })}
    </div>
  </div>
</section>
